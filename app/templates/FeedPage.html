{% extends "layout.html" %}
{% block content %}

<div id="result" style="padding: 50px;">
    <button class = 'btn btn-info btn-sm' onclick="location.href='JobPost'">
        <span class= "fa fa-pen"></span>
        Create a Job Post
    </button>
  <!-- Content to be refreshed goes here -->
  <div class="container d-flex">
       
    <div class="row">
        <div class="content">
                {% for post in job_posts %}
                    <h1>
                        {{post.title}}
                    </h1>
                    <p>Posted By {{post.company}} on {{post.date_posted}}</p>
                    <p>Location : {{post.location}}</p>
                    <p>Job Type : {{post.job_type}}</p>
                    <p>Salary ($AUD): {{post.salary}}</p>
                    <p>Description : {{post.description}}</p>
                {% endfor %}
        </div>
    </div>
    <!-- Grid for displaying posts -->

    <div class="row">

        <!-- Loop through each post -->
        {% for post in posts %}

        <!--for each post access all 12 bootstrap columns-->
        <div class="col-md-12">

            <!-- create a feedbox object -->
            <div class="feedBox">

                <!-- words for post title -->
                <h1> {{post.title}}

                    <!-- label for post title and expandable content-->
                    <span>

                        <!-- stylying button with 3 different selectors -->
                        <button onclick="toggleExpand('expand_btn_{{ loop.index }}')" class = "btn btn-sm btn-outline-info feed_expand_btn" id = "expand_btn_{{ loop.index }}">

                            <!-- image of plus icon as defualt "+" rendering inappropriate-->
                            <img src="../static/plusIcon.png" alt="" style="width: 20px; height: 22px;">
                        </button>
                    </span>
                </h1>

                <!-- Metadata -->
                <p><strong>Posted By {{post.company}} on {{post.date_posted}}</strong></p>
                <p><strong>Location :</strong> {{post.location}}</p>
                <!-- Expandable content section -->
                <div class="expandable_content" id= "expandable_content_{{loop.index}}" style="display: none;">
                    <p><strong>Job Type : </strong>{{post.job_type}}</p>
                    <p><strong>Salary : </strong>{{post.salary}}</p>
                    <p><strong>Description : </strong>{{post.description}}</p>

                    <!-- applying for job button-->
                    <p><button class = 'btn btn-info btn-sm' onclick="applicationExpand('apply_box_{{ loop.index }}')" id = "apply_btn_{{loop.index}}"> <span class= "fa fa-pen"></span> Apply </button></p>

                    <!-- application form-->
                    <div id = "apply_box_{{ loop.index }}" style = "display: none;">
                        <p><strong>Application</strong></p>
                        <p>Please write your application in the box below:</p>
                        <form method = "post">
                            <!-- text box area -->
                            <textarea id = "application" name = "application"></textarea>
                            <br>
                            <!-- submit and save as draft button -->
                            <button type = "submit" class = "post submitButton" id = apply_submit_btn_{{loop.index}}> <span class = "bi bi-send"></span> Submit</button>
                            <p id = "application_response_{{ loop.index }}" class = "application_response" style = "display: none;"></p>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
  </div>
</div>

<!-- script to add response to a user submitting an application-->
<script>
document.addEventListener("DOMContentLoaded", function() {
    // Select all submit buttons correctly
    const submitButtons = document.querySelectorAll('button[type="submit"].post.submitButton, input[type="submit"].post.submitButton');

    //function to display message for only 5 seconds
    function showResponseAndHide(responseElement) {
        // Display the response element
        responseElement.style.display = 'block';

        // Set a timer to hide the response element after 5 seconds
        setTimeout(function() {
            responseElement.style.display = 'none';
        }, 3000); 
    }

    // Function to handle the submit event
    function handleSubmit(event) {
        event.preventDefault(); // Prevents the form from submitting normally

        // Retrieves paragraph to be displayed
        let button = event.target.id;
        let responseElement = document.getElementById('application_response_' + button.split("_")[3]);

        // Selects paragraph to be displayed
        const textOptions = [
            "Thank you for submitting your application! We'll be in touch soon.",
            "Your application has been received. We appreciate your interest!",
            "Success! Your application is in the queue for review.",
            "All set! We've received your application and will review it shortly.",
            "Application submitted successfully. Check your email for confirmation.",
            "Great! We have your application. Please allow some time for processing.",
            "Thanks! We’re thrilled to review your application soon.",
            "Your application is on its way to our team. Stay tuned for updates!",
            "You’ve successfully applied. We’ll notify you with the next steps.",
            "Excellent! We look forward to exploring your application further."
        ];

        // Function to get a random element from the array
        function getRandomText() {
            return textOptions[Math.floor(Math.random() * textOptions.length)];
        }

        // Setting inner HTML
        responseElement.innerHTML = getRandomText();

        //setting inner html style 
        showResponseAndHide(responseElement);
    }

    // Add event listeners to each submit button
    submitButtons.forEach(button => {
        button.addEventListener('click', handleSubmit);
    });
});
</script>

<script>
    function applicationExpand(id) {
        //form id
        let x = document.getElementById(id);

        // application button ID
        let y = document.getElementById("apply_btn_" + id.split("_")[2]);

        if (x.style.display === "none") {
            x.style.display = "block";
            y.innerHTML = '<img src="static/minusIcon.png" alt="" style="width: 20px; height: 22px;">';
        } else {
            x.style.display = "none";
            y.innerHTML = "<i class = 'fa fa-pen'></i> Apply"
        }
    }
</script>

<script>
    function toggleExpand(id) {
        // ID for the button which will expand the content
        let x = document.getElementById(id);
        
        // ID for the content to be expanded
        let y = document.getElementById("expandable_content_" + id.split("_")[2]);
        console.log(y);

        if (y.style.display === "none") {
            y.style.display = "block";
            x.innerHTML = '<img src="static/minusIcon.png" alt="" style="width: 20px; height: 22px;">';
        } else {
            y.style.display = "none";
            x.innerHTML = '<img src="static/plusIcon.png" alt="" style="width: 20px; height: 22px;">';
        }
    }
</script>

{% endblock content %}